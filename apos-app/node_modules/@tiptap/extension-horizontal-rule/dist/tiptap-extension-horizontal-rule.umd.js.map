{"version":3,"file":"tiptap-extension-horizontal-rule.umd.js","sources":["../src/horizontal-rule.ts"],"sourcesContent":["import {\n  Node,\n  nodeInputRule,\n  mergeAttributes,\n} from '@tiptap/core'\nimport { TextSelection } from 'prosemirror-state'\n\nexport interface HorizontalRuleOptions {\n  HTMLAttributes: Record<string, any>,\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    horizontalRule: {\n      /**\n       * Add a horizontal rule\n       */\n      setHorizontalRule: () => ReturnType,\n    }\n  }\n}\n\nexport const HorizontalRule = Node.create<HorizontalRuleOptions>({\n  name: 'horizontalRule',\n\n  defaultOptions: {\n    HTMLAttributes: {},\n  },\n\n  group: 'block',\n\n  parseHTML() {\n    return [\n      { tag: 'hr' },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['hr', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes)]\n  },\n\n  addCommands() {\n    return {\n      setHorizontalRule: () => ({ chain }) => {\n        return chain()\n          // remove node before hr if it’s an empty text block\n          .command(({ tr, dispatch }) => {\n            const { selection } = tr\n            const { empty, $anchor } = selection\n            const isEmptyTextBlock = $anchor.parent.isTextblock\n              && !$anchor.parent.type.spec.code\n              && !$anchor.parent.textContent\n\n            if (!empty || !isEmptyTextBlock || !dispatch) {\n              return true\n            }\n\n            const from = $anchor.before()\n            const to = $anchor.start()\n\n            tr.deleteRange(from, to)\n            tr.setSelection(TextSelection.create(tr.doc, from))\n\n            return true\n          })\n          .insertContent({ type: this.name })\n          // add node after hr if it’s the end of the document\n          .command(({ tr, dispatch }) => {\n            if (dispatch) {\n              const { parent, pos } = tr.selection.$from\n              const posAfter = pos + 1\n              const nodeAfter = tr.doc.nodeAt(posAfter)\n\n              if (!nodeAfter) {\n                const node = parent.type.contentMatch.defaultType?.create()\n\n                if (node) {\n                  tr.insert(posAfter, node)\n                  tr.setSelection(TextSelection.create(tr.doc, posAfter))\n                }\n              }\n\n              tr.scrollIntoView()\n            }\n\n            return true\n          })\n          .run()\n      },\n    }\n  },\n\n  addInputRules() {\n    return [\n      nodeInputRule(/^(?:---|—-|___\\s|\\*\\*\\*\\s)$/, this.type),\n    ]\n  },\n})\n"],"names":["Node","mergeAttributes","TextSelection","nodeInputRule"],"mappings":";;;;;;QAsBa,cAAc,GAAGA,SAAI,CAAC,MAAM,CAAwB;MAC/D,IAAI,EAAE,gBAAgB;MAEtB,cAAc,EAAE;UACd,cAAc,EAAE,EAAE;OACnB;MAED,KAAK,EAAE,OAAO;MAEd,SAAS;UACP,OAAO;cACL,EAAE,GAAG,EAAE,IAAI,EAAE;WACd,CAAA;OACF;MAED,UAAU,CAAC,EAAE,cAAc,EAAE;UAC3B,OAAO,CAAC,IAAI,EAAEC,oBAAe,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE,cAAc,CAAC,CAAC,CAAA;OAC5E;MAED,WAAW;UACT,OAAO;cACL,iBAAiB,EAAE,MAAM,CAAC,EAAE,KAAK,EAAE;kBACjC,OAAO,KAAK,EAAE;;uBAEX,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE;sBACxB,MAAM,EAAE,SAAS,EAAE,GAAG,EAAE,CAAA;sBACxB,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,SAAS,CAAA;sBACpC,MAAM,gBAAgB,GAAG,OAAO,CAAC,MAAM,CAAC,WAAW;6BAC9C,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI;6BAC9B,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,CAAA;sBAEhC,IAAI,CAAC,KAAK,IAAI,CAAC,gBAAgB,IAAI,CAAC,QAAQ,EAAE;0BAC5C,OAAO,IAAI,CAAA;uBACZ;sBAED,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,EAAE,CAAA;sBAC7B,MAAM,EAAE,GAAG,OAAO,CAAC,KAAK,EAAE,CAAA;sBAE1B,EAAE,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA;sBACxB,EAAE,CAAC,YAAY,CAACC,8BAAa,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,CAAA;sBAEnD,OAAO,IAAI,CAAA;mBACZ,CAAC;uBACD,aAAa,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC;;uBAElC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE;;sBACxB,IAAI,QAAQ,EAAE;0BACZ,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,KAAK,CAAA;0BAC1C,MAAM,QAAQ,GAAG,GAAG,GAAG,CAAC,CAAA;0BACxB,MAAM,SAAS,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAA;0BAEzC,IAAI,CAAC,SAAS,EAAE;8BACd,MAAM,IAAI,GAAG,MAAA,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,0CAAE,MAAM,EAAE,CAAA;8BAE3D,IAAI,IAAI,EAAE;kCACR,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAA;kCACzB,EAAE,CAAC,YAAY,CAACA,8BAAa,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC,CAAA;+BACxD;2BACF;0BAED,EAAE,CAAC,cAAc,EAAE,CAAA;uBACpB;sBAED,OAAO,IAAI,CAAA;mBACZ,CAAC;uBACD,GAAG,EAAE,CAAA;eACT;WACF,CAAA;OACF;MAED,aAAa;UACX,OAAO;cACLC,kBAAa,CAAC,6BAA6B,EAAE,IAAI,CAAC,IAAI,CAAC;WACxD,CAAA;OACF;GACF;;;;;;;;;;;"}